SET FEEDBACK OFF
DROP SEQUENCE GPRS_CDR_ID;
DROP INDEX IX_GPRSCDR_CHARGINGID; 
DROP INDEX IX_GPRSCDR_PHONE_NUMBER;
DROP TABLE GPRS_CDR CASCADE CONSTRAINTS;
DROP SEQUENCE AR_GPRS_CDR_ID;
DROP INDEX IX_AR_GPRSCDR_CHARGINGID; 
DROP INDEX IX_AR_GPRSCDR_PHONE_NUMBER;
DROP TABLE ARCHIVED_GPRS_CDR CASCADE CONSTRAINTS;

DROP TABLE TEMP_GPRS_CDR_0 CASCADE CONSTRAINTS ;

DROP TABLE DU_SESSION_STATUS;
DROP TABLE DU_VALID_GPRS_RECORD;
DROP TABLE DU_SGSN_ADDRESSES ;
DROP TABLE DU_SERVICE_ID_DESCRIPTION ;
DROP SEQUENCE DU_MC_CHARGING_ID ;

-- GPRS CDR Table
CREATE SEQUENCE GPRS_CDR_ID INCREMENT BY 1 NOMAXVALUE MINVALUE 1 NOCYCLE CACHE 20 ORDER;
CREATE TABLE GPRS_CDR (
	ID							NUMBER(20,0) 	NOT NULL,
	NETWORK_ID					NUMBER(20,0) 	NOT NULL, 
	RECORD_TYPE					NUMBER(20,0) 	NOT NULL,
	TIME_STAMP					DATE	 		NOT NULL,
	DURATION					NUMBER(20,0) 	NOT NULL,
	PHONE_NUMBER				VARCHAR2(32)	NOT NULL,
	IMSI_NUMBER					VARCHAR2(32),
	IMEI_NUMBER					VARCHAR2(32),
	GEOGRAPHIC_POSITION			VARCHAR2(32),
	CDR_TYPE					NUMBER(20,0)	NOT NULL,
	SERVICE_TYPE				NUMBER(20,0)	NOT NULL,
	PDP_TYPE					VARCHAR2(32),
	SERVED_PDP_ADDRESS			VARCHAR2(32),
	UPLOAD_DATA_VOLUME			NUMBER(20,6)	NOT NULL,
	DOWNLOAD_DATA_VOLUME		NUMBER(20,6)	NOT NULL,
	SERVICE						NUMBER(20,0) 	DEFAULT 2047,
	QOS_REQUESTED				NUMBER(20,0) 	NOT NULL,
	QOS_NEGOTIATED				NUMBER(20,0) 	NOT NULL,
	VALUE						NUMBER(16,6) 	NOT NULL,
	ACCESS_POINT_NAME			VARCHAR2(64),
	SUBSCRIBER_ID				NUMBER(20,0) 	NOT NULL,
	DAY_OF_YEAR					NUMBER(20,0),
	CAUSE_FOR_SESSION_CLOSING	NUMBER(2,0),
	SESSION_STATUS				NUMBER(2,0),
	CHARGING_ID					VARCHAR2(26)     NOT NULL,
	ANI							VARCHAR2(32),
	HOUR_OF_DAY             	NUMBER(20,0) DEFAULT 0,
	VPMN						VARCHAR2(40),
	SENDER_TERMINAL_TYPE        VARCHAR2(256),
    SENDER_TERMINAL_IP_ADDRESS  VARCHAR2(256),
    ORIG_VASP_ID                VARCHAR2(256),
    ORIG_VAS_ID                 VARCHAR2(256),
    SENDER_ROAMING_CLASS        VARCHAR2(256),
    RECIPIENT_TERMINAL_IP_ADDRESS VARCHAR2(256),
    ADDRESS_HIDING_STATUS       VARCHAR2(256),
    DEST_VASP_ID                VARCHAR2(256),
    DEST_VAS_ID                 VARCHAR2(256),
    RECIPIENT_ROAMING_CLASS     VARCHAR2(256),
    FORWARDED_BY                VARCHAR2(256),
    MSG_ID                      VARCHAR2(256),
    PRIORITY                    VARCHAR2(256),
    CNT_SIZE_VIDEO              VARCHAR2(256),
    CNT_NUMBER_VIDEO            VARCHAR2(256),
    CNT_SIZE_AUDIO              VARCHAR2(256),
    CNT_NUMBER_AUDIO            VARCHAR2(256),
    CNT_SIZE_IMAGE              VARCHAR2(256),
    CNT_NUMBER_IMAGE            VARCHAR2(256),
    CNT_SIZE_TEXT               VARCHAR2(256),
    CNT_NUMBER_TEXT             VARCHAR2(256),
    CNT_SIZE_OTHER              VARCHAR2(256),
    CNT_NUMBER_OTHER            VARCHAR2(256),
    RECIPIENT_NUMBER            VARCHAR2(256),
    NO_OF_SUCCESSFUL_RECIPIENTS VARCHAR2(256),
    DEST_MMSC                   VARCHAR2(256),
    DELIVERY_STATUS             VARCHAR2(256),
    ERROR_CAUSE                 VARCHAR2(256),
    TARIFF_CLASS                VARCHAR2(256),
    MESSAGE_CLASS               VARCHAR2(256),
    SENDER_CHARGING_TYPE        VARCHAR2(256),
    RECIPIENT_CHARGING_TYPE     VARCHAR2(256),
    SENDER_PREPAID_STATUS       VARCHAR2(256),
	RECIPIENT_PREPAID_STATUS    VARCHAR2(256),
    OTHER_PARTY_NUMBER          VARCHAR2(256),
	SOURCE		                VARCHAR2(256),
	CELL_SITE_NAME              VARCHAR2(256),
	IN_CHARGE					NUMBER(16,6)
	);

CREATE INDEX IX_GPRSCDR_CHARGINGID ON GPRS_CDR(CHARGING_ID) ;
CREATE INDEX IX_GPRSCDR_PHONE_NUMBER ON GPRS_CDR(PHONE_NUMBER) ;

CREATE TABLE TEMP_GPRS_CDR_0 AS SELECT * FROM GPRS_CDR WHERE 1=2 ;
CREATE OR REPLACE VIEW TEMP_GPRS_CDR_V AS SELECT * FROM TEMP_GPRS_CDR_0 ;

-- Archived GPRS CDR Table
CREATE SEQUENCE AR_GPRS_CDR_ID INCREMENT BY 1 NOMAXVALUE MINVALUE 1 NOCYCLE CACHE 20 ORDER;
CREATE TABLE ARCHIVED_GPRS_CDR (
	ID							NUMBER(20,0) 	NOT NULL,
	NETWORK_ID					NUMBER(20,0) 	NOT NULL, 
	RECORD_TYPE					NUMBER(20,0) 	NOT NULL,
	TIME_STAMP					DATE 			NOT NULL,
	DURATION					NUMBER(20,0) 	NOT NULL,
	PHONE_NUMBER				VARCHAR2(32)	NOT NULL,
	IMSI_NUMBER					VARCHAR2(32),
	IMEI_NUMBER					VARCHAR2(32),
	GEOGRAPHIC_POSITION			VARCHAR2(32),
	CDR_TYPE					NUMBER(20,0)	NOT NULL,
	SERVICE_TYPE				NUMBER(20,0)	NOT NULL,
	PDP_TYPE					VARCHAR2(32),
	SERVED_PDP_ADDRESS			VARCHAR2(32),
	UPLOAD_DATA_VOLUME			NUMBER(20,6)	NOT NULL,
	DOWNLOAD_DATA_VOLUME		NUMBER(20,6)	NOT NULL,
	SERVICE						NUMBER(20,0) 	DEFAULT 2047,
	QOS_REQUESTED				NUMBER(20,0) 	NOT NULL,
	QOS_NEGOTIATED				NUMBER(20,0) 	NOT NULL,
	VALUE						NUMBER(16,6) 	NOT NULL,
	ACCESS_POINT_NAME			VARCHAR2(64),
	SUBSCRIBER_ID				NUMBER(20,0) 	NOT NULL,
	DAY_OF_YEAR					NUMBER(20,0),
	CAUSE_FOR_SESSION_CLOSING	NUMBER(2,0),
	SESSION_STATUS				NUMBER(2,0),
	CHARGING_ID					VARCHAR2(26)     NOT NULL,
	ANI							VARCHAR2(32),
	VPMN						VARCHAR2(40),
	HOUR_OF_DAY             	NUMBER(20,0) DEFAULT 0,
	SENDER_TERMINAL_TYPE        VARCHAR2(256),
    SENDER_TERMINAL_IP_ADDRESS  VARCHAR2(256),
    ORIG_VASP_ID                VARCHAR2(256),
    ORIG_VAS_ID                 VARCHAR2(256),
    SENDER_ROAMING_CLASS        VARCHAR2(256),
    RECIPIENT_TERMINAL_IP_ADDRESS VARCHAR2(256),
    ADDRESS_HIDING_STATUS       VARCHAR2(256),
    DEST_VASP_ID                VARCHAR2(256),
    DEST_VAS_ID                 VARCHAR2(256),
    RECIPIENT_ROAMING_CLASS     VARCHAR2(256),
    FORWARDED_BY                VARCHAR2(256),
    MSG_ID                      VARCHAR2(256),
    PRIORITY                    VARCHAR2(256),
    CNT_SIZE_VIDEO              VARCHAR2(256),
    CNT_NUMBER_VIDEO            VARCHAR2(256),
    CNT_SIZE_AUDIO              VARCHAR2(256),
    CNT_NUMBER_AUDIO            VARCHAR2(256),
    CNT_SIZE_IMAGE              VARCHAR2(256),
    CNT_NUMBER_IMAGE            VARCHAR2(256),
    CNT_SIZE_TEXT               VARCHAR2(256),
    CNT_NUMBER_TEXT             VARCHAR2(256),
    CNT_SIZE_OTHER              VARCHAR2(256),
    CNT_NUMBER_OTHER            VARCHAR2(256),
    RECIPIENT_NUMBER            VARCHAR2(256),
    NO_OF_SUCCESSFUL_RECIPIENTS VARCHAR2(256),
    DEST_MMSC                   VARCHAR2(256),
    DELIVERY_STATUS             VARCHAR2(256),
    ERROR_CAUSE                 VARCHAR2(256),
    TARIFF_CLASS                VARCHAR2(256),
    MESSAGE_CLASS               VARCHAR2(256),
    SENDER_CHARGING_TYPE        VARCHAR2(256),
    RECIPIENT_CHARGING_TYPE     VARCHAR2(256),
    SENDER_PREPAID_STATUS       VARCHAR2(256),
	RECIPIENT_PREPAID_STATUS    VARCHAR2(256),
    OTHER_PARTY_NUMBER          VARCHAR2(256),
	SOURCE		                VARCHAR2(256),
	CELL_SITE_NAME              VARCHAR2(256),
	IN_CHARGE					NUMBER(16,6),
	CONSTRAINT AR_GPRS_CDR_CHARGING_ID check (CHARGING_ID between 0 and 4294967295)
	);

CREATE INDEX IX_AR_GPRSCDR_CHARGINGID ON ARCHIVED_GPRS_CDR(CHARGING_ID) ;
CREATE INDEX IX_AR_GPRSCDR_PHONE_NUMBER ON ARCHIVED_GPRS_CDR(PHONE_NUMBER) ;

-- Table For determining the SESSION_STATUS
CREATE TABLE DU_SESSION_STATUS (
	CAUSE_FOR_SESSION 			VARCHAR2(10),
	OUTPUT 						NUMBER(10)
	);

-- Table For filtering Invalid GPRS_CDR
CREATE TABLE DU_VALID_GPRS_RECORD (
	FIELD_ID					VARCHAR2(20),
	CDR_TYPE					VARCHAR2(40)
	);

CREATE TABLE DU_SGSN_ADDRESSES(
	DESCRIPTION					VARCHAR2(256),
	SGSN_ADDRESS				VARCHAR2(256)
) ;

CREATE TABLE DU_SERVICE_ID_DESCRIPTION(
	SERVICE_ID				VARCHAR2(256),
	DESCRIPTION				VARCHAR2(256)
) ;

CREATE SEQUENCE DU_MC_CHARGING_ID INCREMENT BY 1 NOMAXVALUE MINVALUE 1 NOCYCLE CACHE 2000 ORDER;

QUIT;
