spool test_cleanup_setup.log;
set feedback off;
set serveroutput on;
DROP TABLE CDR ;
CREATE TABLE CDR (
	ID                  NUMBER(20,0)    NOT NULL,
	NETWORK_ID          NUMBER(20,0)    NOT NULL,
	CALLER_NUMBER       VARCHAR2(40),
	CALLED_NUMBER       VARCHAR2(40),
	FORWARDED_NUMBER    VARCHAR2(40),
	RECORD_TYPE         NUMBER(20,0)    NOT NULL,
	DURATION            NUMBER(20,0)    NOT NULL,
	TIME_STAMP          DATE        	NOT NULL,
	EQUIPMENT_ID        VARCHAR2(40),
	IMSI_NUMBER         VARCHAR2(40) ,
	GEOGRAPHIC_POSITION VARCHAR2(32),
	CALL_TYPE           NUMBER(20,0)    NOT NULL,
	SUBSCRIBER_ID       NUMBER(20,0)    NOT NULL,
	VALUE               NUMBER(16,6)    NOT NULL,
	CDR_TYPE            NUMBER(20,0)    NOT NULL,
	SERVICE_TYPE        NUMBER(20,0)    NOT NULL,
	CDR_CATEGORY        NUMBER(20,0)    DEFAULT 1 NOT NULL,
	IS_COMPLETE         NUMBER(20)      NOT NULL,
	IS_ATTEMPTED        NUMBER(20)      NOT NULL,
	SERVICE             NUMBER(20,0) 	DEFAULT 2047,
	PHONE_NUMBER        VARCHAR2(40),	
	DAY_OF_YEAR         NUMBER(20,0) 	DEFAULT 0,
	HOUR_OF_DAY         NUMBER(20,0) 	DEFAULT 0,
	OTHER_PARTY_COUNTRY_CODE	VARCHAR2(32),
	VPMN                        VARCHAR2(40)
)
INITRANS 4 STORAGE(FREELISTS 16)
PARTITION BY RANGE(DAY_OF_YEAR)
SUBPARTITION BY LIST(HOUR_OF_DAY)
SUBPARTITION TEMPLATE
(
	SUBPARTITION SP_0 VALUES (0, 1, 2, 3),
	SUBPARTITION SP_1 VALUES (4, 5, 6, 7),
	SUBPARTITION SP_2 VALUES (8, 9, 10, 11),
	SUBPARTITION SP_3 VALUES (12, 13, 14, 15),
	SUBPARTITION SP_4 VALUES (16, 17, 18, 19),
	SUBPARTITION SP_5 VALUES (20, 21, 22, 23)
)
(
	PARTITION P0 VALUES LESS THAN (90),
	PARTITION P1 VALUES LESS THAN (180),
	PARTITION P2 VALUES LESS THAN (270),
	PARTITION P3 VALUES LESS THAN (360),
	PARTITION P4 VALUES LESS THAN (367)
) ENABLE ROW MOVEMENT ;

delete from record_subpartitions where table_name = 'CDR' ;
insert into record_subpartitions
	select 	table_name,
			partition_name,
			subpartition_name
	from user_tab_subpartitions where table_name = 'CDR';

update dbwriter_configurations set OFFLINE_TNAME = NULL ;

DROP TABLE ARCHIVED_CDR_TEST ;
DROP TABLE ARCHIVED_GPRS_CDR_TEST ;
CREATE TABLE ARCHIVED_CDR_TEST AS SELECT * FROM CDR WHERE 1 = 2 ;
CREATE TABLE ARCHIVED_GPRS_CDR_TEST AS SELECT * FROM GPRS_CDR WHERE 1 = 2 ;

DROP TABLE ARCHIVED_ALARM_CDR_TEST ;
DROP TABLE ARCHIVED_ALARM_GPRS_CDR_TEST ;
CREATE TABLE ARCHIVED_ALARM_CDR_TEST AS SELECT * FROM ALARM_CDR WHERE 1 = 2 ;
CREATE TABLE ARCHIVED_ALARM_GPRS_CDR_TEST AS SELECT * FROM ALARM_GPRS_CDR WHERE 1 = 2 ;


CREATE TABLE CDR_TEST (
	ID                  NUMBER(20,0)    NOT NULL,
	NETWORK_ID          NUMBER(20,0)    NOT NULL,
	CALLER_NUMBER       VARCHAR2(40),
	CALLED_NUMBER       VARCHAR2(40),
	FORWARDED_NUMBER    VARCHAR2(40),
	RECORD_TYPE         NUMBER(20,0)    NOT NULL,
	DURATION            NUMBER(20,0)    NOT NULL,
	TIME_STAMP          DATE        	NOT NULL,
	EQUIPMENT_ID        VARCHAR2(40),
	IMSI_NUMBER         VARCHAR2(40) ,
	GEOGRAPHIC_POSITION VARCHAR2(32),
	CALL_TYPE           NUMBER(20,0)    NOT NULL,
	SUBSCRIBER_ID       NUMBER(20,0)    NOT NULL,
	VALUE               NUMBER(16,6)    NOT NULL,
	CDR_TYPE            NUMBER(20,0)    NOT NULL,
	SERVICE_TYPE        NUMBER(20,0)    NOT NULL,
	CDR_CATEGORY        NUMBER(20,0)    DEFAULT 1 NOT NULL,
	IS_COMPLETE         NUMBER(20)      NOT NULL,
	IS_ATTEMPTED        NUMBER(20)      NOT NULL,
	SERVICE             NUMBER(20,0) 	DEFAULT 2047,
	PHONE_NUMBER        VARCHAR2(40),	
	DAY_OF_YEAR         NUMBER(20,0) 	DEFAULT 0,
	HOUR_OF_DAY         NUMBER(20,0) 	DEFAULT 0,
	OTHER_PARTY_COUNTRY_CODE	VARCHAR2(32),
	VPMN                        VARCHAR2(40)
)
INITRANS 4 STORAGE(FREELISTS 16)
PARTITION BY RANGE(DAY_OF_YEAR)
SUBPARTITION BY LIST(HOUR_OF_DAY)
SUBPARTITION TEMPLATE
(
	SUBPARTITION SP_0 VALUES (0, 1, 2, 3),
	SUBPARTITION SP_1 VALUES (4, 5, 6, 7),
	SUBPARTITION SP_2 VALUES (8, 9, 10, 11),
	SUBPARTITION SP_3 VALUES (12, 13, 14, 15),
	SUBPARTITION SP_4 VALUES (16, 17, 18, 19),
	SUBPARTITION SP_5 VALUES (20, 21, 22, 23)
)
(
	PARTITION P000 VALUES LESS THAN (1),
	PARTITION P001 VALUES LESS THAN (2),
	PARTITION P002 VALUES LESS THAN (3),
	PARTITION P003 VALUES LESS THAN (4),
	PARTITION P004 VALUES LESS THAN (5),
	PARTITION P364 VALUES LESS THAN (364),
	PARTITION P365 VALUES LESS THAN (365),
	PARTITION P366 VALUES LESS THAN (366)
) ENABLE ROW MOVEMENT ;

delete from record_subpartitions where table_name = 'CDR_TEST' ;
insert into record_subpartitions
	select 	table_name,
			partition_name,
			subpartition_name
	from user_tab_subpartitions where table_name = 'CDR_TEST' ;

CREATE TABLE OFFLINE_CDR_TEST (
	ID                  NUMBER(20,0)    NOT NULL,
	NETWORK_ID          NUMBER(20,0)    NOT NULL,
	CALLER_NUMBER       VARCHAR2(40),
	CALLED_NUMBER       VARCHAR2(40),
	FORWARDED_NUMBER    VARCHAR2(40),
	RECORD_TYPE         NUMBER(20,0)    NOT NULL,
	DURATION            NUMBER(20,0)    NOT NULL,
	TIME_STAMP          DATE        	NOT NULL,
	EQUIPMENT_ID        VARCHAR2(40),
	IMSI_NUMBER         VARCHAR2(40) ,
	GEOGRAPHIC_POSITION VARCHAR2(32),
	CALL_TYPE           NUMBER(20,0)    NOT NULL,
	SUBSCRIBER_ID       NUMBER(20,0)    NOT NULL,
	VALUE               NUMBER(16,6)    NOT NULL,
	CDR_TYPE            NUMBER(20,0)    NOT NULL,
	SERVICE_TYPE        NUMBER(20,0)    NOT NULL,
	CDR_CATEGORY        NUMBER(20,0)    DEFAULT 1 NOT NULL,
	IS_COMPLETE         NUMBER(20)      NOT NULL,
	IS_ATTEMPTED        NUMBER(20)      NOT NULL,
	SERVICE             NUMBER(20,0) 	DEFAULT 2047,
	PHONE_NUMBER        VARCHAR2(40),	
	DAY_OF_YEAR         NUMBER(20,0) 	DEFAULT 0,
	HOUR_OF_DAY         NUMBER(20,0) 	DEFAULT 0,
	OTHER_PARTY_COUNTRY_CODE	VARCHAR2(32),
	VPMN                        VARCHAR2(40)
)
INITRANS 4 STORAGE(FREELISTS 16)
PARTITION BY RANGE(DAY_OF_YEAR)
(
	PARTITION P000 VALUES LESS THAN (1),
	PARTITION P001 VALUES LESS THAN (2),
	PARTITION P002 VALUES LESS THAN (3),
	PARTITION P003 VALUES LESS THAN (4),
	PARTITION P004 VALUES LESS THAN (5),
	PARTITION P350 VALUES LESS THAN (349), 
	PARTITION P351 VALUES LESS THAN (350),
	PARTITION P352 VALUES LESS THAN (351),
	PARTITION P353 VALUES LESS THAN (352),
	PARTITION P354 VALUES LESS THAN (353),
	PARTITION P355 VALUES LESS THAN (354),
	PARTITION P356 VALUES LESS THAN (355),
	PARTITION P357 VALUES LESS THAN (356),
	PARTITION P358 VALUES LESS THAN (357),
	PARTITION P359 VALUES LESS THAN (358),
	PARTITION P360 VALUES LESS THAN (359),
	PARTITION P361 VALUES LESS THAN (360),
	PARTITION P362 VALUES LESS THAN (361),
	PARTITION P363 VALUES LESS THAN (362),
	PARTITION P364 VALUES LESS THAN (363),
	PARTITION P365 VALUES LESS THAN (364)
) ENABLE ROW MOVEMENT ;

spool off;
