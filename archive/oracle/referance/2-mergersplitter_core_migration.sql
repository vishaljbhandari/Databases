SET SERVEROUTPUT ON;
SET FEEDBACK ON;
SPOOL mergersplitter_core_migration.log

-- THIS TABLE IS RESPONSIBLE FOR MERGER SPLITTER CONFIGURATIONS
CREATE TABLE MERGER_SPLITTER_CONFIGURATIONS 
(	
	RECORD_TYPE NUMBER(10) NOT NULL CHECK(RECORD_TYPE>0), 
	GROUP_ID VARCHAR(2) NOT NULL,
	IS_ENABLE NUMBER(1) NOT NULL CHECK(IS_ENABLE IN (0,1)),
	DELIMITER VARCHAR(1) NOT NULL CHECK(DELIMITER IN ('|',',',';')), 
	SPLIT_POSITION NUMBER(3) NOT NULL CHECK(SPLIT_POSITION>0), 
	INPUT_DIRECTORY VARCHAR(500) NOT NULL,
	INPUT_SUB_DIRECTORY VARCHAR(500) DEFAULT 'Process' NOT NULL,	
	REJECT_DIRECTORY_PATH VARCHAR(500),
	OUTPUT_DIRECTORY_PATH VARCHAR(500) NOT NULL,
	OUTPUT_DIRECTORY_PREFIX VARCHAR(500) NOT NULL,
	OUTPUT_SUB_DIRECTORY VARCHAR(500) DEFAULT 'Process' NOT NULL,
	OUTPUT_DIRECTORIES_LIST VARCHAR(500),
	OUTPUT_BATCHFILE_PREFIX VARCHAR(50) NOT NULL,	
	SPLIT_DIRECTORY_COUNT NUMBER(3) DEFAULT 1 CHECK(SPLIT_DIRECTORY_COUNT>0),
	BATCH_SIZE NUMBER(10) DEFAULT 500 CHECK(BATCH_SIZE>=1),
    TIMEOUT_VALUE NUMBER(3) DEFAULT 150 CHECK(TIMEOUT_VALUE>50),
	DIRECTORY_DIGITS NUMBER(5) DEFAULT 1 CHECK(DIRECTORY_DIGITS>0),
	DIR_DIGIT_STARTS NUMBER(5) DEFAULT 1 CHECK(DIR_DIGIT_STARTS>=0),
	SPLIT_TYPE VARCHAR2(1) DEFAULT 'H' CHECK(SPLIT_TYPE IN ('H','R')),
	FIELDS_COUNT NUMBER(3) DEFAULT 1 CHECK(FIELDS_COUNT>0),
	SPLIT_FIELD_TYPE VARCHAR(1) DEFAULT NULL,
	LOGGING_TYPE VARCHAR(2) DEFAULT 'D' CHECK(LOGGING_TYPE IN ('D', 'F', 'N')),
	FS_DESCRIPTION VARCHAR(4000),
	CONSTRAINT MERGER_SPLITTER_TASKS_PK PRIMARY KEY(GROUP_ID, RECORD_TYPE, INPUT_DIRECTORY, IS_ENABLE),
	CONSTRAINT MERGER_SPLITTER_DIR_UN UNIQUE(INPUT_DIRECTORY, IS_ENABLE),
	CONSTRAINT MERGER_SPLITTER_SPLT_POS CHECK (FIELDS_COUNT >= SPLIT_POSITION)
);

-- THIS TABLE IS FOR MAPING OF INPUT AND OUTPUT FILES
CREATE TABLE MERGER_SPLITTER_FILE_MAPPER 
( 	
	RECORD_TYPE VARCHAR2(10) NOT NULL,
	OUTPUT_DIRECTORY_INDEX NUMBER(5) NOT NULL,
	OUTPUT_FILE_NAME VARCHAR2(250) NOT NULL, 
	INPUT_FILE_NAME VARCHAR2(4000) NOT NULL, 
	OUTPUT_FILE_RECORDS NUMBER(10) CHECK(OUTPUT_FILE_RECORDS>0),
	FILE_TIME DATE DEFAULT CURRENT_TIMESTAMP,
	CONTINUE_FLAG NUMBER(3) DEFAULT 0 CHECK (CONTINUE_FLAG>=0),
	CONSTRAINT PK_MERGSPLITMAPER PRIMARY KEY (OUTPUT_FILE_NAME)
); 

-- REQUIRED CONFIGURATION SETTINGS
    INSERT
    INTO CONFIGURATIONS 
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
        (configurations_seq.nextval, 'MERGERSPLITTER_TIMER_SLEEP_INTERVAL', '120', '1');
	INSERT
	INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
		(configurations_seq.nextval, 'MERGERSPLITTER_MAXFILE_QUEUE_SIZE', '1000', '1');
	INSERT
	INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
		(configurations_seq.nextval, 'MERGERSPLITTER_RETENTION_PERIODE','30','1');
	INSERT
	INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
		(configurations_seq.nextval, 'MERGERSPLITTER_LOGFILES_LOCATION','', 1);
	INSERT
    INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
        (configurations_seq.nextval, 'MERGERSPLITTER_NOTIFICATION_TO_MAILID','', 1);
    INSERT
	INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
		(configurations_seq.nextval, 'MERGERSPLITTER_NOTIFICATION_FROM_MAILID','', 1);
    INSERT
    INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
        (configurations_seq.nextval, 'MERGERSPLITTER_REJECT_FILE_THRESHOLD','50',1);
	INSERT
    INTO CONFIGURATIONS
        (ID, CONFIG_KEY, VALUE, IS_VISIBLE)
    VALUES
		(configurations_seq.nextval, 'MERGERSPLITTER_REJECT_RECORD_THRESHOLD','50',1);
	
	-- THIS IS FOR ADDING MERGER SPLITTER CLEAN UP ENTRY IN CRON TAB
	INSERT 
	INTO SCHEDULER_COMMAND_MAPS
		(JOB_NAME, COMMAND, IS_PARAMETER_REQUIRED, IS_NETWORK_BASED, IS_MANDATORY) 
	VALUES 
		('MERGERSPLITTER CLEANUP', 'mergersplittercleanup.rb,MergerSplitterCleanupPid', 0, 0, 1);

COMMIT;
