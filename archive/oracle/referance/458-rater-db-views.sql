-- ********************************************************************************
-- *  Copyright(c) Subexazure Limited 2006. All Rights Reserved.               *
-- *  The copyright to the Computer Program(s) herein is the property of Subex    *
-- *  systems limited. the program(s) may be used and/or copied with the written  *
-- *  permission from subex systems limited or in accordance with the terms and   *
-- *  conditions stipulated in the agreement/contract under which the program(s)  *
-- *  have been supplied.                                                         *
-- ********************************************************************************

SET FEEDBACK OFF

CREATE OR REPLACE VIEW FREE_NUMBER
(
	DESCRIPTION, FREE_NUMBER, NETWORK_ID
)
AS
(
 	SELECT DESCRIPTION, FREE_NUMBER, NETWORK_ID
	FROM FREE_NUMBERS, FREE_NUMBERS_NETWORKS
	WHERE FREE_NUMBERS.ID = FREE_NUMBERS_NETWORKS.FREE_NUMBER_ID 
) ;

CREATE OR REPLACE VIEW ORG_DEST_LINK
(
	ORG_GEO_CODE,DEST_GEO_CODE,ZONE_CODE,NATIONAL_FLAG,LETTER_CODE
)
AS
(
	SELECT ORG_GEO_CODE,DEST_GEO_CODE,ZONE_CODE,NATIONAL_FLAG,LETTER_CODE
	FROM ORG_DEST_LINKS
) ;

CREATE OR REPLACE VIEW RATE_PER_CALL
(
	SERVICE_NUMBER,DESCRIPTION,CALL_TYPE,SERVICE_CATEGORY,SERVICE_PROVIDER,SERVICE_BAND,
	AIR_AMOUNT_PER_CALL,PSTN_AMOUNT_PER_CALL,EXTRA_CHARGE
)
AS
(
	SELECT SERVICE_NUMBER,DESCRIPTION,CALL_TYPE,SERVICE_CATEGORY,SERVICE_PROVIDER,SERVICE_BAND,AIR_AMOUNT_PER_CALL,
		PSTN_AMOUNT_PER_CALL,EXTRA_CHARGE
	FROM RATE_PER_CALLS
) ;

CREATE OR REPLACE VIEW RATE_TYPE
(
	RATE_TYPE,DESCRIPTION
)
AS
(
	SELECT RATE_TYPE,DESCRIPTION FROM RATE_TYPES
) ;

CREATE OR REPLACE VIEW TIME_ZONE_RATE_TYPE
(
	DAY_TYPE,START_TIME,END_TIME,SERVICE_CATEGORY,NATIONAL_FLAG,RATE_TYPE
)
AS
(
	SELECT DAY_TYPE,START_TIME,END_TIME,SERVICE_CATEGORY,NATIONAL_FLAG,RATE_TYPE
	FROM TIME_ZONE_RATE_TYPES
) ;


CREATE OR REPLACE VIEW RATER_SPECIAL_NUMBER
(
	DESCRIPTION, SPECIAL_NUMBER, SERVICE_CATEGORY, MIN_CHARGEABLE_UNIT, MIN_CHARGE, PULSE, RATE,
	PSTN_MIN_CHARGEABLE_UNIT, PSTN_MIN_CHARGE, PSTN_PULSE, PSTN_RATE, EXTRA_CHARGE, NETWORK_ID, CALL_TYPE, PMN
)
AS
(
	SELECT DESCRIPTION, SPECIAL_NUMBER, SERVICE_CATEGORY, MIN_CHARGEABLE_UNIT, MIN_CHARGE, PULSE, RATE,
		PSTN_MIN_CHARGEABLE_UNIT, PSTN_MIN_CHARGE, PSTN_PULSE, PSTN_RATE, EXTRA_CHARGE, NETWORK_ID, CALL_TYPE, PMN
	FROM RATER_SPECIAL_NUMBERS, NETWORKS_RATER_SPECIAL_NUMBERS
	WHERE RATER_SPECIAL_NUMBERS.ID = NETWORKS_RATER_SPECIAL_NUMBERS.RATER_SPECIAL_NUMBER_ID
) ;

CREATE OR REPLACE VIEW RATE_PLAN
(
	RATE_PLAN,ROAMER_FLAG,RATE_PLAN_ID,ORG_NUMBER_TYPE,DEST_NUMBER_TYPE,ZONE_CODE,RATE_TYPE,CALL_TYPE,SERVICE_BAND,
	MIN_CHARGEABLE_UNIT,MIN_CHARGE,PULSE,RATE,PSTN_MIN_CHARGEABLE_UNIT,PSTN_MIN_CHARGE,PSTN_PULSE,PSTN_RATE,FF_MIN_CHARGEABLE_UNIT,
	FF_MIN_CHARGE,FF_PULSE,FF_RATE,FF_PSTN_MIN_CHARGEABLE_UNIT,FF_PSTN_MIN_CHARGE,FF_PSTN_PULSE,FF_PSTN_RATE,EXTRA_CHARGE
)
AS
(
	SELECT RATE_PLAN,ROAMER_FLAG,RATE_PLAN_ID,ORG_NUMBER_TYPE,DEST_NUMBER_TYPE,ZONE_CODE,RATE_TYPE,CALL_TYPE,SERVICE_BAND,
		MIN_CHARGEABLE_UNIT,MIN_CHARGE,PULSE,RATE,PSTN_MIN_CHARGEABLE_UNIT,PSTN_MIN_CHARGE,PSTN_PULSE,PSTN_RATE,FF_MIN_CHARGEABLE_UNIT,
		FF_MIN_CHARGE,FF_PULSE,FF_RATE,FF_PSTN_MIN_CHARGEABLE_UNIT,FF_PSTN_MIN_CHARGE,FF_PSTN_PULSE,FF_PSTN_RATE,EXTRA_CHARGE
	FROM RATE_PLANS
) ;


CREATE OR REPLACE VIEW HOLIDAY_LIST
(
	HOLIDAY_DATE, DESCRIPTION, NETWORK_ID
)
AS
(
	SELECT HOLIDAY_DATE, DESCRIPTION, NETWORK_ID
	FROM HOLIDAY_LISTS, HOLIDAY_LISTS_NETWORKS
	WHERE HOLIDAY_LISTS.ID = HOLIDAY_LISTS_NETWORKS.HOLIDAY_LIST_ID
) ;

CREATE OR REPLACE VIEW WEEKEND
(
	WEEKEND,DESCRIPTION
)
AS
(
	SELECT WEEKEND,DESCRIPTION FROM WEEKENDS
) ;

CREATE OR REPLACE VIEW DEFAULT_RATE
(
	RATE_TYPE,CALL_TYPE,PULSE,RATE
)
AS
(
	SELECT RATE_TYPE,CALL_TYPE,PULSE,RATE FROM DEFAULT_RATES
) ;

CREATE OR REPLACE VIEW RCF_INFO
(
	LETTER_CODE,VPLMN_ID,IMSI_CODE,PLMN_NAME
)
AS
(
	SELECT LETTER_CODE,VPLMN_ID,IMSI_CODE,PLMN_NAME FROM RCF_INFOS
) ;

CREATE OR REPLACE VIEW NETWORK
(
	ID,SHORT_NAME,DESCRIPTION
)
AS
(
	SELECT ID,SHORT_NAME,DESCRIPTION FROM NETWORKS
) ;


CREATE OR REPLACE VIEW SDR_RATE
(
	NETWORK_ID, START_DATE, END_DATE, SDR_VALUE
)
AS
(
	SELECT NETWORK_ID, START_DATE, END_DATE, SDR_VALUE
	FROM SDR_RATES, NETWORKS_SDR_RATES
	WHERE SDR_RATES.ID = NETWORKS_SDR_RATES.SDR_RATE_ID
) ;

CREATE OR REPLACE VIEW CONFIGURATION
(
	ID, VALUE
)
AS
(
	SELECT CONFIG_KEY, VALUE FROM CONFIGURATIONS
) ;

ALTER TABLE CELL_SITE_GEO_POSITIONS MODIFY CELL_LOCATION VARCHAR2(256) ;
CREATE OR REPLACE VIEW CELL_SITE_GEO_POSITION
(
	ID,CELL_SITE_ID,LONGITUDE,LATITUDE,CELL_LOCATION,RADIUS_COVERAGE,NETWORK_ID,TIME_ZONE
)
AS
(
	SELECT ID,CELL_SITE_ID,LONGITUDE,LATITUDE,CELL_LOCATION,RADIUS_COVERAGE,NETWORK_ID,TIME_ZONE
	FROM CELL_SITE_GEO_POSITIONS
) ;

-- Rater Summary related Function
CREATE OR REPLACE FUNCTION GET_SDR_VALUE (VALUE IN NUMBER, CDR_TIME IN DATE) RETURN NUMBER IS
SDR_VALUE NUMBER(16,6) := NULL ;
BEGIN
	SELECT SDR_VALUE INTO SDR_VALUE FROM SDR_RATE WHERE CDR_TIME BETWEEN START_DATE AND END_DATE ;
	RETURN VALUE / SDR_VALUE ;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		SELECT VALUE INTO SDR_VALUE FROM CONFIGURATION WHERE ID = 'DEFAULT_SDR_RATE' ;
		RETURN VALUE / SDR_VALUE ;
END ;
/
--


COMMIT ;
QUIT;
